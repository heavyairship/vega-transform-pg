var r=require("vega"),e=require("querystring"),t=require("http");function n(e){r.Transform.call(this,[],e)}n.setHttpOptions=function(r){return r?(this._options=r,this):this._options},n.Definition={type:"postgres",metadata:{changes:!0,source:!0},params:[{name:"query",type:"string",required:!0}]},r.inherits(n,r.Transform).transform=function(o,s){try{var i=this;if(!n._options)throw Error("Vega Transform Postgres query missing. Assign it with setQuery.");return Promise.resolve(new Promise(function(r,s){console.log(o.query);var i=e.stringify({query:o.query});n._options["Content-Length"]=Buffer.byteLength(i);var u=t.request(n._options,function(e){var t="";e.on("data",function(r){t+=r}),e.on("end",function(){r(JSON.parse(t).rows)})});u.on("error",function(r){console.error("Error: "+r),s()}),u.write(i),u.end()})).then(function(e){console.log(e),e.forEach(r.ingest);var t=s.fork(s.NO_FIELDS&s.NO_SOURCE);return t.rem=i.value,i.value=t.add=t.source=e,t})}catch(r){return Promise.reject(r)}},module.exports=n;
//# sourceMappingURL=vega-transform-pg.js.map
