!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("vega")):"function"==typeof define&&define.amd?define(["vega"],r):e.VegaTransformPostgres=r(e.vega)}(this,function(e){var r=require("querystring"),n=require("http");function t(r){e.Transform.call(this,[],r)}return t.setHttpOptions=function(e){return e?(this._options=e,this):this._options},t.Definition={type:"postgres",metadata:{changes:!0,source:!0},params:[{name:"query",type:"string",required:!0}]},e.inherits(t,e.Transform).transform=function(o,i){try{var s=this;if(!t._options)throw Error("Vega Transform Postgres query missing. Assign it with setQuery.");return Promise.resolve(new Promise(function(e,i){console.log(o.query);var s=r.stringify({query:o.query});t._options["Content-Length"]=Buffer.byteLength(s);var u=n.request(t._options,function(r){var n="";r.on("data",function(e){n+=e}),r.on("end",function(){e(JSON.parse(n).rows)})});u.on("error",function(e){console.error("Error: "+e),i()}),u.write(s),u.end()})).then(function(r){console.log(r),r.forEach(e.ingest);var n=i.fork(i.NO_FIELDS&i.NO_SOURCE);return n.rem=s.value,s.value=n.add=n.source=r,n})}catch(e){return Promise.reject(e)}},t});
//# sourceMappingURL=vega-transform-pg.umd.js.map
